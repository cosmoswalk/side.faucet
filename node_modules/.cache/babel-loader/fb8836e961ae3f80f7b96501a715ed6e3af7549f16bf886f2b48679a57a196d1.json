{"ast":null,"code":"import _regeneratorRuntime from\"/mobile.dev/side.faucet/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/mobile.dev/side.faucet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/mobile.dev/side.faucet/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import axios from'axios';import'./Keplr.css';import Modal from'react-modal';import loader from'./loader.gif';import{ur,tag,urip}from'./share.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Loader=function Loader(){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:loader,width:40,alt:\"Loading...\"})});};Modal.setAppElement('#root');export default function AddNetworkKeplr(_ref){var params=_ref.params;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isCopied=_useState4[0],setIsCopied=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),walletError=_useState6[0],setWalletError=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),walletAddress=_useState8[0],setWalletAddress=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),errorMessage=_useState10[0],setErrorMessage=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isConnected=_useState12[0],setIsConnected=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),modalIsOpen=_useState14[0],setModalIsOpen=_useState14[1];var _useState15=useState({message:'',type:''}),_useState16=_slicedToArray(_useState15,2),modalMessage=_useState16[0],setModalMessage=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),serverError=_useState18[0],setServerError=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),balance=_useState20[0],setBalance=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),balanceData=_useState22[0],setBalanceData=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),txhash=_useState24[0],setTxhash=_useState24[1];var _useState25=useState(''),_useState26=_slicedToArray(_useState25,2),responseMessage=_useState26[0],setResponseMessage=_useState26[1];var _useState27=useState(''),_useState28=_slicedToArray(_useState27,2),userIP=_useState28[0],setUserIP=_useState28[1];function getIPAddress(){return _getIPAddress.apply(this,arguments);}function _getIPAddress(){_getIPAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var response,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(urip);case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:data=_context3.sent;return _context3.abrupt(\"return\",data.ip);case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",null);case 13:case\"end\":return _context3.stop();}},_callee3,null,[[0,10]]);}));return _getIPAddress.apply(this,arguments);}function delay(time){return new Promise(function(resolve){return setTimeout(resolve,time);});}function openModal(message,type){setModalMessage({message:message,type:type});setModalIsOpen(true);}var closeModal=function closeModal(){setModalIsOpen(false);setLoading(false);};function disconnectKeplr(){return _disconnectKeplr.apply(this,arguments);}function _disconnectKeplr(){_disconnectKeplr=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:setIsConnected(false);setWalletAddress('');localStorage.removeItem('walletAddress');case 3:case\"end\":return _context4.stop();}},_callee4);}));return _disconnectKeplr.apply(this,arguments);}var copyToClipboard=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(text){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.clipboard.writeText(text);case 2:setIsCopied(true);setTimeout(function(){return setIsCopied(false);},1500);case 4:case\"end\":return _context.stop();}},_callee);}));return function copyToClipboard(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"https://api.side-testnet.stake-take.com/cosmos/bank/v1beta1/balances/\".concat(walletAddress));case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;setBalanceData(data);case 7:case\"end\":return _context2.stop();}},_callee2);}));return function fetchData(){return _ref3.apply(this,arguments);};}();fetchData();},[walletAddress]);var displayAmount=function displayAmount(balanceData){if(!balanceData||!balanceData.balances||balanceData.balances.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"balance\",children:\"Balance: 0 side\"});}var amount=balanceData.balances[0].amount;var sum=Number(amount)/Math.pow(1,10);return/*#__PURE__*/_jsxs(\"div\",{className:\"balance\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Balance:  \"}),/*#__PURE__*/_jsxs(\"div\",{className:\"sum\",children:[sum,\" uside\"]})]});};function getAddress(_x2){return _getAddress.apply(this,arguments);}function _getAddress(){_getAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(params){var chainId,_chainId,offlineSigner,accounts;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(window.keplr){_context5.next=4;break;}openModal('Please install keplr extension!','installExtension');_context5.next=34;break;case 4:if(!window.keplr.experimentalSuggestChain){_context5.next=14;break;}_context5.prev=5;chainId=params.chainId;_context5.next=9;return window.keplr.experimentalSuggestChain({chainId:chainId,chainName:params.chainName,rpc:params.rpc,rest:params.rest,bip44:{coinType:118},bech32Config:{bech32PrefixAccAddr:\"side\",bech32PrefixAccPub:\"side\"+\"pub\",bech32PrefixValAddr:\"side\"+\"valoper\",bech32PrefixValPub:\"side\"+\"valoperpub\",bech32PrefixConsAddr:\"side\"+\"valcons\",bech32PrefixConsPub:\"side\"+\"valconspub\"},currencies:[{coinDenom:\"SIDE\",coinMinimalDenom:\"uSIDE\",coinDecimals:6,coinGeckoId:\"side\"}],feeCurrencies:[{coinDenom:\"SIDE\",coinMinimalDenom:\"uSIDE\",coinDecimals:6,coinGeckoId:\"side\",gasPriceStep:{low:0.01,average:0.025,high:0.04}}],stakeCurrency:{coinDenom:\"SIDE\",coinMinimalDenom:\"uSIDE\",coinDecimals:6,coinGeckoId:\"side\"}});case 9:_context5.next=14;break;case 11:_context5.prev=11;_context5.t0=_context5[\"catch\"](5);alert(\"Failed to suggest the chain\");case 14:_context5.prev=14;_chainId=params.chainId;_context5.next=18;return window.keplr.enable(_chainId);case 18:offlineSigner=window.getOfflineSigner(_chainId);_context5.next=21;return offlineSigner.getAccounts();case 21:accounts=_context5.sent;setBalanceData(balance);setWalletAddress(accounts[0].address);setErrorMessage('');// Clear any previous error messages\nconsole.log('Wallet Address:',accounts[0].address);localStorage.setItem('walletAddress',accounts[0].address);setWalletError('');// Clear any previous error messages\n_context5.next=34;break;case 30:_context5.prev=30;_context5.t1=_context5[\"catch\"](14);setWalletError('Error getting wallet address: '+_context5.t1);openModal('Error getting wallet address: '+_context5.t1);case 34:case\"end\":return _context5.stop();}},_callee5,null,[[5,11],[14,30]]);}));return _getAddress.apply(this,arguments);}function getTokens(){return _getTokens.apply(this,arguments);}function _getTokens(){_getTokens=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var ipAddress,response;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:setLoading(true);if(walletAddress){_context6.next=5;break;}openModal('Please connect your wallet first!','error');setLoading(false);return _context6.abrupt(\"return\");case 5:_context6.prev=5;_context6.next=8;return getIPAddress();case 8:ipAddress=_context6.sent;if(ipAddress){_context6.next=14;break;}console.log(\"IP ADDRESS \"+ipAddress);openModal('Please try again later.','error');setLoading(false);return _context6.abrupt(\"return\");case 14:_context6.next=16;return axios.post(\"https://side.faucet.stake-take.com/api/faucet/into\",{walletAddress:walletAddress,ipAddress:ipAddress},{headers:{'Content-Type':'application/json','x-api-key':process.env.REACT_APP_API_KEY}});case 16:response=_context6.sent;if(response.status===200){console.log('Hash of transaction:       '+response.data.txhash);txHashRef(response.data.txhash);openModal('Tokens successfully received!','success');}else{openModal(response.data.message,'error');}_context6.next=23;break;case 20:_context6.prev=20;_context6.t0=_context6[\"catch\"](5);if(_context6.t0.response){console.error(\"Error response:\",_context6.t0.response.data);openModal(_context6.t0.response.data.message,'error');}else{console.error(\"Error:\",_context6.t0.message);openModal('An unknown error occurred','error');}case 23:case\"end\":return _context6.stop();}},_callee6,null,[[5,20]]);}));return _getTokens.apply(this,arguments);}function add(){return _add.apply(this,arguments);}function _add(){_add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:if(!walletAddress){_context7.next=5;break;}_context7.next=3;return disconnectKeplr();case 3:_context7.next=7;break;case 5:_context7.next=7;return getAddress(params);case 7:case\"end\":return _context7.stop();}},_callee7);}));return _add.apply(this,arguments);}function twit(){var twitterUsername1='SideProtocol';var twitterUrl1=\"https://twitter.com/intent/follow?screen_name=\".concat(twitterUsername1);window.open(twitterUrl1,'_blank');}function twitSt(){var twitterUsername2='StakeAndTake';var twitterUrl2=\"https://twitter.com/intent/follow?screen_name=\".concat(twitterUsername2);window.open(twitterUrl2,'_blank');}function txHashRef(txhash){var txhash_ref=\"https://testnet.ping.pub/side/tx/\".concat(txhash);window.open(txhash_ref,'_blank');}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"walletAddressButton\",onClick:add,children:walletAddress?'Disconnect Keplr':'Connect Keplr'}),/*#__PURE__*/_jsx(\"button\",{className:\"getTokens\",onClick:getTokens,children:loading?/*#__PURE__*/_jsx(Loader,{}):'Get Tokens'}),/*#__PURE__*/_jsxs(\"div\",{className:\"popup \".concat(walletAddress?'show':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"t_address\",children:\"Wallet Address:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"_address\",onClick:function onClick(){return copyToClipboard(walletAddress);},children:walletAddress}),isCopied&&/*#__PURE__*/_jsx(\"div\",{className:\"message_tooltip\",children:\"Copied!\\uD83D\\uDE0A\"}),/*#__PURE__*/_jsx(\"div\",{className:\"balance\",children:balanceData?displayAmount(balanceData):'Loading...'})]}),/*#__PURE__*/_jsx(Modal,{isOpen:modalIsOpen,onRequestClose:closeModal,className:\"Modal\",overlayClassName:\"modalOverlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ModalContainer\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"closeButton\",onClick:closeModal,children:\"X\"}),/*#__PURE__*/_jsx(\"p\",{className:\"modalMessage\",children:modalMessage.type==='installExtension'?/*#__PURE__*/_jsx(\"a\",{href:\"https://keplr.app/\",target:\"_blank\",rel:\"noopener noreferrer\",className:\"modalMessage\",children:modalMessage.message}):modalMessage.message||serverError}),modalMessage.message==='Tokens successfully received!'&&/*#__PURE__*/_jsxs(\"div\",{className:\"modalButtons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"Twit\",onClick:twit,children:/*#__PURE__*/_jsxs(\"div\",{className:\"text\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://stake-take.com/assets/twitter.svg\",alt:\"Stake-Take\",height:\"20\",width:\"20\"}),\"Follow SIDE\"]})}),/*#__PURE__*/_jsx(\"button\",{className:\"TwitSt\",onClick:twitSt,children:/*#__PURE__*/_jsxs(\"div\",{className:\"text\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://stake-take.com/assets/twitter.svg\",alt:\"Stake-Take\",height:\"20\",width:\"20\"}),\"Follow Us\"]})}),/*#__PURE__*/_jsx(\"button\",{className:\"TxHash\",onClick:txHashRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"text\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://testnet.ping.pub/assets/logo-fea46f13.svg\",alt:\"Stake-Take\",height:\"20\",width:\"20\"}),\"Transaction\\uD83E\\uDE90\"]})})]})]})})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}